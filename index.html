<!DOCTYPE html><html lang="en"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataForge • Transform Your Data</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&amp;family=Sora:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Sora', 'sans-serif'],
                        mono: ['Space Mono', 'monospace'],
                    },
                    colors: {
                        forge: {
                            50: '#fef7ec',
                            100: '#fcecc8',
                            200: '#f9d88c',
                            300: '#f5be4f',
                            400: '#f2a628',
                            500: '#eb8a0f',
                            600: '#cf6509',
                            700: '#ac460b',
                            800: '#8c3710',
                            900: '#732e10',
                        },
                        night: {
                            800: '#1a1a2e',
                            900: '#0f0f1a',
                            950: '#080810',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --gradient-start: #f5be4f;
            --gradient-end: #eb8a0f;
        }
        .dark {
            --gradient-start: #f2a628;
            --gradient-end: #cf6509;
        }

        body {
            background: linear-gradient(135deg, #fef7ec 0%, #fcecc8 50%, #fff 100%);
        }
        .dark body {
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #080810 100%);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .dark .glass-card {
            background: rgba(26, 26, 46, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glow-border {
            position: relative;
        }
        .glow-border::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: inherit;
            padding: 2px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .glow-border:hover::before, .glow-border:focus-within::before {
            opacity: 1;
        }

        .drop-zone {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        .dark .drop-zone {
            border-color: #374151;
        }
        .drop-zone.dragover {
            border-color: #f2a628;
            background: rgba(242, 166, 40, 0.1);
            transform: scale(1.01);
        }

        .table-container {
            max-height: 50vh;
            overflow: auto;
        }
        .table-container::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .table-container::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
            border-radius: 4px;
        }
        .table-container::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            border-radius: 4px;
        }

        .data-table th {
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            user-select: none;
        }
        .data-table th:hover {
            background: linear-gradient(135deg, #cf6509, #ac460b);
        }
        .data-table th .sort-icon {
            opacity: 0.4;
            transition: opacity 0.2s;
        }
        .data-table th.sorted .sort-icon {
            opacity: 1;
        }

        .btn-forge {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            transition: all 0.3s ease;
        }
        .btn-forge:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px -10px rgba(235, 138, 15, 0.5);
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse-dot {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .toast {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .cell-input {
            background: transparent;
            border: 2px solid #f2a628;
            border-radius: 4px;
            padding: 2px 6px;
            width: 100%;
            min-width: 80px;
            outline: none;
        }

        .ai-glow {
            animation: aiGlow 2s ease-in-out infinite;
        }
        @keyframes aiGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(139, 92, 246, 0.3); }
            50% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.6); }
        }

        .typing-indicator span {
            animation: typingBounce 1.4s infinite ease-in-out;
        }
        .typing-indicator span:nth-child(1) { animation-delay: 0s; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typingBounce {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-6px); }
        }

        .highlight-row {
            background: rgba(139, 92, 246, 0.15) !important;
        }
    </style>
</head>
<body class="min-h-screen font-sans text-gray-800 dark:text-gray-100">
    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 flex flex-col gap-2"></div>

    <!-- Header -->
    <header class="py-6 px-4">
        <div class="max-w-6xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-forge-400 to-forge-600 flex items-center justify-center shadow-lg">
                    <i class="fas fa-fire text-white text-lg"></i>
                </div>
                <h1 class="text-2xl font-bold bg-gradient-to-r from-forge-600 to-forge-500 bg-clip-text text-transparent">
                    DataForge
                </h1>
            </div>
            <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400">
                <span class="pulse-dot w-2 h-2 rounded-full bg-green-500"></span>
                <span class="font-mono">Ready</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="px-4 pb-12">
        <div class="max-w-6xl mx-auto">

            <!-- Input Section -->
            <section id="inputSection" class="mb-8 fade-in">
                <div class="glass-card rounded-2xl p-6 md:p-8 shadow-xl">
                    <div class="flex flex-col md:flex-row gap-4 mb-6">
                        <button id="tabPaste" class="tab-btn flex-1 py-3 px-6 rounded-xl font-semibold transition-all bg-forge-500 text-white shadow-lg">
                            <i class="fas fa-paste mr-2"></i>Paste Data
                        </button>
                        <button id="tabUpload" class="tab-btn flex-1 py-3 px-6 rounded-xl font-semibold transition-all bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600">
                            <i class="fas fa-upload mr-2"></i>Upload File
                        </button>
                    </div>

                    <!-- Paste Panel -->
                    <div id="pastePanel">
                        <div class="glow-border rounded-xl">
                            <textarea id="dataInput" class="w-full h-48 md:h-64 p-4 rounded-xl bg-white dark:bg-night-800 border border-gray-200 dark:border-gray-700 font-mono text-sm resize-none focus:outline-none focus:ring-2 focus:ring-forge-400" placeholder="Paste your data here...

Supported formats:
• CSV (comma, semicolon, tab separated)
• JSON (array of objects)
• TSV (tab separated values)
• Key-value pairs"></textarea>
                        </div>
                        <div class="mt-4 flex flex-wrap gap-3">
                            <button id="parseBtn" class="btn-forge py-3 px-8 rounded-xl font-semibold text-white shadow-lg">
                                <i class="fas fa-wand-magic-sparkles mr-2"></i>Parse Data
                            </button>
                            <button id="clearInputBtn" class="py-3 px-6 rounded-xl font-semibold bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition-all">
                                <i class="fas fa-eraser mr-2"></i>Clear
                            </button>
                        </div>
                    </div>

                    <!-- Upload Panel -->
                    <div id="uploadPanel" class="hidden">
                        <div id="dropZone" class="drop-zone rounded-xl p-12 text-center cursor-pointer hover:border-forge-400 transition-all">
                            <div class="mb-4">
                                <i class="fas fa-cloud-arrow-up text-5xl text-forge-400"></i>
                            </div>
                            <p class="text-lg font-semibold mb-2">Drop your file here</p>
                            <p class="text-gray-500 dark:text-gray-400 text-sm mb-4">or click to browse</p>
                            <div class="flex flex-wrap justify-center gap-2 text-xs">
                                <span class="px-3 py-1 rounded-full bg-forge-100 dark:bg-forge-900/30 text-forge-700 dark:text-forge-300">.csv</span>
                                <span class="px-3 py-1 rounded-full bg-forge-100 dark:bg-forge-900/30 text-forge-700 dark:text-forge-300">.json</span>
                                <span class="px-3 py-1 rounded-full bg-forge-100 dark:bg-forge-900/30 text-forge-700 dark:text-forge-300">.tsv</span>
                                <span class="px-3 py-1 rounded-full bg-forge-100 dark:bg-forge-900/30 text-forge-700 dark:text-forge-300">.txt</span>
                                <span class="px-3 py-1 rounded-full bg-forge-100 dark:bg-forge-900/30 text-forge-700 dark:text-forge-300">.xlsx</span>
                            </div>
                            <input type="file" id="fileInput" class="hidden" accept=".csv,.json,.tsv,.txt,.xlsx,.xls">
                        </div>
                        <div id="fileInfo" class="hidden mt-4 p-4 rounded-xl bg-forge-50 dark:bg-forge-900/20 border border-forge-200 dark:border-forge-800">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-file-lines text-forge-500 text-xl"></i>
                                <div class="flex-1 min-w-0">
                                    <p id="fileName" class="font-semibold truncate"></p>
                                    <p id="fileSize" class="text-sm text-gray-500 dark:text-gray-400"></p>
                                </div>
                                <button id="removeFileBtn" class="p-2 text-gray-400 hover:text-red-500 transition-colors">
                                    <i class="fas fa-xmark"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Output Section -->
            <section id="outputSection" class="hidden fade-in">
                <div class="glass-card rounded-2xl p-6 md:p-8 shadow-xl">
                    <!-- Stats Bar -->
                    <div class="flex flex-wrap items-center justify-between gap-4 mb-4">
                        <div class="flex flex-wrap gap-4">
                            <div class="flex items-center gap-2 px-4 py-2 rounded-lg bg-forge-100 dark:bg-forge-900/30">
                                <i class="fas fa-table-cells text-forge-600"></i>
                                <span class="font-mono text-sm"><span id="rowCount">0</span> rows</span>
                            </div>
                            <div class="flex items-center gap-2 px-4 py-2 rounded-lg bg-forge-100 dark:bg-forge-900/30">
                                <i class="fas fa-columns text-forge-600"></i>
                                <span class="font-mono text-sm"><span id="colCount">0</span> columns</span>
                            </div>
                            <div id="filteredInfo" class="hidden items-center gap-2 px-4 py-2 rounded-lg bg-violet-100 dark:bg-violet-900/30">
                                <i class="fas fa-filter text-violet-600"></i>
                                <span class="font-mono text-sm"><span id="filteredCount">0</span> shown</span>
                            </div>
                        </div>
                        <button id="backBtn" class="py-2 px-4 rounded-lg text-sm font-semibold bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition-all">
                            <i class="fas fa-arrow-left mr-2"></i>New Data
                        </button>
                    </div>

                    <!-- Search & AI Query Bar -->
                    <div class="flex flex-col lg:flex-row gap-4 mb-4">
                        <!-- Search Input -->
                        <div class="flex-1 glow-border rounded-xl">
                            <div class="relative">
                                <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <input type="text" id="searchInput" class="w-full py-3 pl-12 pr-4 rounded-xl bg-white dark:bg-night-800 border border-gray-200 dark:border-gray-700 text-base focus:outline-none focus:ring-2 focus:ring-forge-400" placeholder="Search across all columns...">
                                <button id="clearSearch" class="hidden absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <!-- AI Query Input -->
                        <div class="flex-1 glow-border rounded-xl ai-glow">
                            <div class="relative">
                                <i class="fas fa-wand-magic-sparkles absolute left-4 top-1/2 -translate-y-1/2 text-violet-500"></i>
                                <input type="text" id="aiQueryInput" class="w-full py-3 pl-12 pr-24 rounded-xl bg-white dark:bg-night-800 border border-violet-300 dark:border-violet-700 text-base focus:outline-none focus:ring-2 focus:ring-violet-400" placeholder="Ask AI: &quot;Show rows where sales > 1000&quot;">
                                <button id="aiQueryBtn" class="absolute right-2 top-1/2 -translate-y-1/2 py-1.5 px-4 rounded-lg bg-violet-500 hover:bg-violet-600 text-white text-sm font-semibold transition-all">
                                    <i class="fas fa-bolt mr-1"></i>Ask
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- AI Response Area -->
                    <div id="aiResponseArea" class="hidden mb-4 p-4 rounded-xl bg-violet-50 dark:bg-violet-900/20 border border-violet-200 dark:border-violet-800">
                        <div class="flex items-start gap-3">
                            <div class="w-8 h-8 rounded-lg bg-violet-500 flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-robot text-white text-sm"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p id="aiResponseText" class="text-sm text-gray-700 dark:text-gray-300"></p>
                                <div id="aiTypingIndicator" class="hidden typing-indicator flex gap-1 mt-2">
                                    <span class="w-2 h-2 rounded-full bg-violet-500"></span>
                                    <span class="w-2 h-2 rounded-full bg-violet-500"></span>
                                    <span class="w-2 h-2 rounded-full bg-violet-500"></span>
                                </div>
                            </div>
                            <button id="clearAiFilter" class="hidden py-1 px-3 rounded-lg bg-violet-200 dark:bg-violet-800 text-violet-700 dark:text-violet-300 text-sm font-medium hover:bg-violet-300 dark:hover:bg-violet-700 transition-all">
                                <i class="fas fa-times mr-1"></i>Clear
                            </button>
                        </div>
                    </div>

                    <!-- Pagination Controls (Top) -->
                    <div class="flex flex-wrap items-center justify-between gap-4 mb-4">
                        <div class="flex items-center gap-3">
                            <label class="text-sm text-gray-600 dark:text-gray-400">Show</label>
                            <select id="pageSizeSelect" class="py-2 px-3 rounded-lg bg-white dark:bg-night-800 border border-gray-200 dark:border-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-forge-400">
                                <option value="10">10</option>
                                <option value="25" selected="">25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                                <option value="all">All</option>
                            </select>
                            <span class="text-sm text-gray-600 dark:text-gray-400">entries</span>
                        </div>
                        <div id="paginationControls" class="flex items-center gap-2">
                            <button id="prevPage" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <div id="pageNumbers" class="flex items-center gap-1"></div>
                            <button id="nextPage" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Table -->
                    <div class="table-container rounded-xl border border-gray-200 dark:border-gray-700 mb-4">
                        <table id="dataTable" class="data-table w-full text-sm">
                            <thead id="tableHead" class="bg-gradient-to-r from-forge-500 to-forge-600 text-white"></thead>
                            <tbody id="tableBody" class="bg-white dark:bg-night-800"></tbody>
                        </table>
                    </div>

                    <!-- Page Info -->
                    <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                        <p id="pageInfo" class="text-sm text-gray-600 dark:text-gray-400"></p>
                        <p class="text-xs text-gray-400 dark:text-gray-500">
                            <i class="fas fa-info-circle mr-1"></i>
                            Double-click cells to edit • Click headers to sort
                        </p>
                    </div>

                    <!-- Export Buttons -->
                    <div class="flex flex-wrap gap-3">
                        <button id="exportExcel" class="btn-forge py-3 px-6 rounded-xl font-semibold text-white shadow-lg flex items-center gap-2">
                            <i class="fas fa-file-excel"></i>
                            <span class="hidden sm:inline">Export</span> Excel
                        </button>
                        <button id="exportCsv" class="py-3 px-6 rounded-xl font-semibold bg-emerald-500 hover:bg-emerald-600 text-white shadow-lg transition-all flex items-center gap-2">
                            <i class="fas fa-file-csv"></i>
                            <span class="hidden sm:inline">Export</span> CSV
                        </button>
                        <button id="copyTable" class="py-3 px-6 rounded-xl font-semibold bg-indigo-500 hover:bg-indigo-600 text-white shadow-lg transition-all flex items-center gap-2">
                            <i class="fas fa-copy"></i>
                            Copy Table
                        </button>
                        <button id="copyJson" class="py-3 px-6 rounded-xl font-semibold bg-violet-500 hover:bg-violet-600 text-white shadow-lg transition-all flex items-center gap-2">
                            <i class="fas fa-code"></i>
                            Copy JSON
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Custom Modal -->
    <div id="modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
        <div class="glass-card rounded-2xl p-6 max-w-md w-full shadow-2xl">
            <div class="flex items-center gap-3 mb-4">
                <div id="modalIcon" class="w-10 h-10 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center">
                    <i class="fas fa-exclamation-triangle text-red-500"></i>
                </div>
                <h3 id="modalTitle" class="text-lg font-semibold">Error</h3>
            </div>
            <p id="modalMessage" class="text-gray-600 dark:text-gray-300 mb-6"></p>
            <div class="flex justify-end">
                <button id="modalClose" class="py-2 px-6 rounded-xl font-semibold bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition-all">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // State
        let parsedData = [];
        let filteredData = [];
        let headers = [];
        let currentFile = null;
        let sortColumn = null;
        let sortDirection = 'asc';
        let currentPage = 1;
        let pageSize = 25;
        let searchTerm = '';
        let aiFilteredIndices = null; // null means no AI filter, array means specific indices

        // DOM Elements
        const tabPaste = document.getElementById('tabPaste');
        const tabUpload = document.getElementById('tabUpload');
        const pastePanel = document.getElementById('pastePanel');
        const uploadPanel = document.getElementById('uploadPanel');
        const dataInput = document.getElementById('dataInput');
        const parseBtn = document.getElementById('parseBtn');
        const clearInputBtn = document.getElementById('clearInputBtn');
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const removeFileBtn = document.getElementById('removeFileBtn');
        const inputSection = document.getElementById('inputSection');
        const outputSection = document.getElementById('outputSection');
        const tableHead = document.getElementById('tableHead');
        const tableBody = document.getElementById('tableBody');
        const rowCount = document.getElementById('rowCount');
        const colCount = document.getElementById('colCount');
        const filteredInfo = document.getElementById('filteredInfo');
        const filteredCount = document.getElementById('filteredCount');
        const backBtn = document.getElementById('backBtn');
        const searchInput = document.getElementById('searchInput');
        const clearSearch = document.getElementById('clearSearch');
        const aiQueryInput = document.getElementById('aiQueryInput');
        const aiQueryBtn = document.getElementById('aiQueryBtn');
        const aiResponseArea = document.getElementById('aiResponseArea');
        const aiResponseText = document.getElementById('aiResponseText');
        const aiTypingIndicator = document.getElementById('aiTypingIndicator');
        const clearAiFilter = document.getElementById('clearAiFilter');
        const pageSizeSelect = document.getElementById('pageSizeSelect');
        const prevPage = document.getElementById('prevPage');
        const nextPage = document.getElementById('nextPage');
        const pageNumbers = document.getElementById('pageNumbers');
        const pageInfo = document.getElementById('pageInfo');
        const exportExcel = document.getElementById('exportExcel');
        const exportCsv = document.getElementById('exportCsv');
        const copyTable = document.getElementById('copyTable');
        const copyJson = document.getElementById('copyJson');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalClose = document.getElementById('modalClose');
        const toastContainer = document.getElementById('toastContainer');

        // Tab switching
        tabPaste.addEventListener('click', () => {
            tabPaste.classList.add('bg-forge-500', 'text-white', 'shadow-lg');
            tabPaste.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-600', 'dark:text-gray-300');
            tabUpload.classList.remove('bg-forge-500', 'text-white', 'shadow-lg');
            tabUpload.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-600', 'dark:text-gray-300');
            pastePanel.classList.remove('hidden');
            uploadPanel.classList.add('hidden');
        });

        tabUpload.addEventListener('click', () => {
            tabUpload.classList.add('bg-forge-500', 'text-white', 'shadow-lg');
            tabUpload.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-600', 'dark:text-gray-300');
            tabPaste.classList.remove('bg-forge-500', 'text-white', 'shadow-lg');
            tabPaste.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-600', 'dark:text-gray-300');
            uploadPanel.classList.remove('hidden');
            pastePanel.classList.add('hidden');
        });

        // Toast notifications
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-emerald-500' : type === 'error' ? 'bg-red-500' : 'bg-indigo-500';
            const icon = type === 'success' ? 'fa-check' : type === 'error' ? 'fa-xmark' : 'fa-info';
            toast.className = `toast ${bgColor} text-white px-4 py-3 rounded-xl shadow-lg flex items-center gap-3`;
            toast.innerHTML = `<i class="fas ${icon}"></i><span>${message}</span>`;
            toastContainer.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                toast.style.transition = 'all 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Modal
        function showModal(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        modalClose.addEventListener('click', () => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
        });

        // File handling
        dropZone.addEventListener('click', () => fileInput.click());

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        removeFileBtn.addEventListener('click', () => {
            currentFile = null;
            fileInput.value = '';
            fileInfo.classList.add('hidden');
        });

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        function handleFile(file) {
            currentFile = file;
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            fileInfo.classList.remove('hidden');

            const ext = file.name.split('.').pop().toLowerCase();

            if (ext === 'xlsx' || ext === 'xls') {
                parseExcelFile(file);
            } else {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const content = e.target.result;
                    if (ext === 'json') {
                        parseJSON(content);
                    } else {
                        parseCSV(content);
                    }
                };
                reader.readAsText(file);
            }
        }

        function parseExcelFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

                    if (jsonData.length > 0) {
                        headers = jsonData[0].map((h, i) => h || `Column ${i + 1}`);
                        parsedData = jsonData.slice(1).map(row => {
                            const obj = {};
                            headers.forEach((h, i) => {
                                obj[h] = row[i] !== undefined ? row[i] : '';
                            });
                            return obj;
                        });
                        initializeTable();
                    } else {
                        showModal('Error', 'The Excel file appears to be empty.');
                    }
                } catch (err) {
                    showModal('Parse Error', 'Could not parse the Excel file. Please check the format.');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Parsing functions
        function parseCSV(text) {
            try {
                const result = Papa.parse(text.trim(), {
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: true
                });

                if (result.errors.length > 0 && result.data.length === 0) {
                    showModal('Parse Error', 'Could not parse CSV data. Please check the format.');
                    return;
                }

                if (result.data.length > 0) {
                    headers = result.meta.fields || Object.keys(result.data[0]);
                    parsedData = result.data;
                    initializeTable();
                } else {
                    showModal('Error', 'No data found in the input.');
                }
            } catch (err) {
                showModal('Parse Error', 'Could not parse the data. Please check the format.');
            }
        }

        function parseJSON(text) {
            try {
                let data = JSON.parse(text);

                if (!Array.isArray(data)) {
                    if (typeof data === 'object') {
                        const arrayKey = Object.keys(data).find(key => Array.isArray(data[key]));
                        if (arrayKey) {
                            data = data[arrayKey];
                        } else {
                            data = [data];
                        }
                    }
                }

                if (data.length > 0) {
                    parsedData = data.map(item => flattenObject(item));
                    headers = [...new Set(parsedData.flatMap(item => Object.keys(item)))];
                    initializeTable();
                } else {
                    showModal('Error', 'No data found in the JSON.');
                }
            } catch (err) {
                parseCSV(text);
            }
        }

        function flattenObject(obj, prefix = '') {
            const result = {};
            for (const key in obj) {
                const newKey = prefix ? `${prefix}.${key}` : key;
                if (typeof obj[key] === 'object' && obj[key] !== null && !Array.isArray(obj[key])) {
                    Object.assign(result, flattenObject(obj[key], newKey));
                } else if (Array.isArray(obj[key])) {
                    result[newKey] = JSON.stringify(obj[key]);
                } else {
                    result[newKey] = obj[key];
                }
            }
            return result;
        }

        function detectAndParse(text) {
            text = text.trim();
            if (!text) {
                showModal('Error', 'Please enter or paste some data first.');
                return;
            }

            if (text.startsWith('[') || text.startsWith('{')) {
                parseJSON(text);
            } else {
                parseCSV(text);
            }
        }

        // Initialize table after parsing
        function initializeTable() {
            if (parsedData.length === 0 || headers.length === 0) {
                showModal('Error', 'No valid data to display.');
                return;
            }

            // Reset state
            sortColumn = null;
            sortDirection = 'asc';
            currentPage = 1;
            searchTerm = '';
            aiFilteredIndices = null;
            searchInput.value = '';
            clearSearch.classList.add('hidden');
            aiResponseArea.classList.add('hidden');
            clearAiFilter.classList.add('hidden');

            // Apply filters and render
            applyFilters();

            // Update stats
            rowCount.textContent = parsedData.length;
            colCount.textContent = headers.length;

            // Show output section
            inputSection.classList.add('hidden');
            outputSection.classList.remove('hidden');
            outputSection.classList.add('fade-in');

            showToast(`Loaded ${parsedData.length} rows successfully!`);
        }

        // Filter and sort data
        function applyFilters() {
            let data = [...parsedData];

            // Apply AI filter first (if any)
            if (aiFilteredIndices !== null) {
                data = aiFilteredIndices.map(i => parsedData[i]).filter(Boolean);
            }

            // Apply search filter
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                data = data.filter(row =>
                    headers.some(h => {
                        const val = row[h];
                        return val !== null && val !== undefined && String(val).toLowerCase().includes(term);
                    })
                );
            }

            // Apply sorting
            if (sortColumn !== null) {
                data.sort((a, b) => {
                    let valA = a[sortColumn];
                    let valB = b[sortColumn];

                    // Handle null/undefined
                    if (valA === null || valA === undefined) valA = '';
                    if (valB === null || valB === undefined) valB = '';

                    // Try numeric comparison
                    const numA = parseFloat(valA);
                    const numB = parseFloat(valB);
                    if (!isNaN(numA) && !isNaN(numB)) {
                        return sortDirection === 'asc' ? numA - numB : numB - numA;
                    }

                    // String comparison
                    const strA = String(valA).toLowerCase();
                    const strB = String(valB).toLowerCase();
                    if (sortDirection === 'asc') {
                        return strA.localeCompare(strB);
                    } else {
                        return strB.localeCompare(strA);
                    }
                });
            }

            filteredData = data;
            updateFilteredInfo();
            renderTable();
        }

        function updateFilteredInfo() {
            if (searchTerm || aiFilteredIndices !== null) {
                filteredInfo.classList.remove('hidden');
                filteredInfo.classList.add('flex');
                filteredCount.textContent = filteredData.length;
            } else {
                filteredInfo.classList.add('hidden');
                filteredInfo.classList.remove('flex');
            }
        }

        // Render table with pagination
        function renderTable() {
            // Build header
            tableHead.innerHTML = `<tr>${headers.map(h => {
                const isSorted = sortColumn === h;
                const sortIcon = isSorted
                    ? (sortDirection === 'asc' ? 'fa-sort-up' : 'fa-sort-down')
                    : 'fa-sort';
                return `<th class="px-4 py-3 text-left font-semibold whitespace-nowrap ${isSorted ? 'sorted' : ''}" data-column="${escapeHtml(String(h))}">
                    <span class="flex items-center gap-2">
                        ${escapeHtml(String(h))}
                        <i class="fas ${sortIcon} sort-icon text-xs"></i>
                    </span>
                </th>`;
            }).join('')}</tr>`;

            // Calculate pagination
            const totalRows = filteredData.length;
            const showAll = pageSize === 'all';
            const effectivePageSize = showAll ? totalRows : parseInt(pageSize);
            const totalPages = showAll ? 1 : Math.ceil(totalRows / effectivePageSize);

            // Adjust current page if needed
            if (currentPage > totalPages) currentPage = Math.max(1, totalPages);

            const startIdx = showAll ? 0 : (currentPage - 1) * effectivePageSize;
            const endIdx = showAll ? totalRows : Math.min(startIdx + effectivePageSize, totalRows);
            const pageData = filteredData.slice(startIdx, endIdx);

            // Build body
            tableBody.innerHTML = pageData.map((row, idx) => {
                const globalIdx = startIdx + idx;
                return `<tr class="${idx % 2 === 0 ? 'bg-gray-50 dark:bg-night-900/50' : ''} hover:bg-forge-50 dark:hover:bg-forge-900/20 transition-colors" data-row-index="${globalIdx}">
                    ${headers.map(h =>
                        `<td class="px-4 py-3 border-b border-gray-100 dark:border-gray-800 whitespace-nowrap cursor-pointer" data-column="${escapeHtml(String(h))}" data-row-index="${globalIdx}">${escapeHtml(String(row[h] ?? ''))}</td>`
                    ).join('')}
                </tr>`;
            }).join('');

            // Update page info
            if (totalRows === 0) {
                pageInfo.textContent = 'No results found';
            } else {
                pageInfo.textContent = `Showing ${startIdx + 1} to ${endIdx} of ${totalRows} entries`;
            }

            // Update pagination controls
            updatePaginationControls(totalPages);

            // Attach event listeners
            attachTableEventListeners();
        }

        function updatePaginationControls(totalPages) {
            prevPage.disabled = currentPage <= 1;
            nextPage.disabled = currentPage >= totalPages;

            // Build page numbers
            pageNumbers.innerHTML = '';
            const maxVisible = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
            let endPage = Math.min(totalPages, startPage + maxVisible - 1);
            if (endPage - startPage + 1 < maxVisible) {
                startPage = Math.max(1, endPage - maxVisible + 1);
            }

            if (startPage > 1) {
                pageNumbers.innerHTML += `<button class="page-num px-3 py-1 rounded-lg text-sm hover:bg-gray-200 dark:hover:bg-gray-700" data-page="1">1</button>`;
                if (startPage > 2) {
                    pageNumbers.innerHTML += `<span class="px-2 text-gray-400">...</span>`;
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentPage;
                pageNumbers.innerHTML += `<button class="page-num px-3 py-1 rounded-lg text-sm ${isActive ? 'bg-forge-500 text-white' : 'hover:bg-gray-200 dark:hover:bg-gray-700'}" data-page="${i}">${i}</button>`;
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pageNumbers.innerHTML += `<span class="px-2 text-gray-400">...</span>`;
                }
                pageNumbers.innerHTML += `<button class="page-num px-3 py-1 rounded-lg text-sm hover:bg-gray-200 dark:hover:bg-gray-700" data-page="${totalPages}">${totalPages}</button>`;
            }

            // Add click listeners to page numbers
            pageNumbers.querySelectorAll('.page-num').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentPage = parseInt(btn.dataset.page);
                    renderTable();
                });
            });
        }

        function attachTableEventListeners() {
            // Sort on header click
            tableHead.querySelectorAll('th').forEach(th => {
                th.addEventListener('click', () => {
                    const column = th.dataset.column;
                    if (sortColumn === column) {
                        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                    } else {
                        sortColumn = column;
                        sortDirection = 'asc';
                    }
                    applyFilters();
                });
            });

            // Inline editing on double-click
            tableBody.querySelectorAll('td').forEach(td => {
                td.addEventListener('dblclick', () => {
                    if (td.querySelector('input')) return; // Already editing

                    const column = td.dataset.column;
                    const rowIndex = parseInt(td.dataset.rowIndex);
                    const currentValue = filteredData[rowIndex][column] ?? '';

                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'cell-input dark:text-white dark:bg-night-800';
                    input.value = currentValue;

                    td.textContent = '';
                    td.appendChild(input);
                    input.focus();
                    input.select();

                    const saveEdit = () => {
                        const newValue = input.value;
                        td.textContent = newValue;

                        // Update the data - find the original row
                        const originalRow = filteredData[rowIndex];
                        originalRow[column] = newValue;

                        // Also update in parsedData
                        const originalIndex = parsedData.indexOf(originalRow);
                        if (originalIndex !== -1) {
                            parsedData[originalIndex][column] = newValue;
                        }

                        showToast('Cell updated', 'info');
                    };

                    input.addEventListener('blur', saveEdit);
                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            input.blur();
                        } else if (e.key === 'Escape') {
                            td.textContent = currentValue;
                        }
                    });
                });
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Search functionality
        searchInput.addEventListener('input', (e) => {
            searchTerm = e.target.value;
            currentPage = 1;
            clearSearch.classList.toggle('hidden', !searchTerm);
            applyFilters();
        });

        clearSearch.addEventListener('click', () => {
            searchInput.value = '';
            searchTerm = '';
            currentPage = 1;
            clearSearch.classList.add('hidden');
            applyFilters();
        });

        // Pagination controls
        pageSizeSelect.addEventListener('change', (e) => {
            pageSize = e.target.value === 'all' ? 'all' : parseInt(e.target.value);
            currentPage = 1;
            renderTable();
        });

        prevPage.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderTable();
            }
        });

        nextPage.addEventListener('click', () => {
            const totalRows = filteredData.length;
            const effectivePageSize = pageSize === 'all' ? totalRows : parseInt(pageSize);
            const totalPages = Math.ceil(totalRows / effectivePageSize);
            if (currentPage < totalPages) {
                currentPage++;
                renderTable();
            }
        });

        // AI Query functionality
        aiQueryBtn.addEventListener('click', handleAiQuery);
        aiQueryInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') handleAiQuery();
        });

        async function handleAiQuery() {
            const query = aiQueryInput.value.trim();
            if (!query) return;

            // Check if Poe API is available
            if (!window.Poe || !window.Poe.sendUserMessage) {
                showModal('API Not Available', 'The Poe Embed API is not available in this environment. Please run this app on Poe.');
                return;
            }

            // Show loading state
            aiResponseArea.classList.remove('hidden');
            aiTypingIndicator.classList.remove('hidden');
            aiResponseText.textContent = 'Analyzing your data...';
            aiQueryBtn.disabled = true;
            aiQueryBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>...';

            // Prepare data summary for AI
            const sampleData = parsedData.slice(0, 5);
            const dataContext = `
You are a data query assistant. The user has a dataset with the following columns: ${headers.join(', ')}.

Total rows: ${parsedData.length}

Sample data (first 5 rows):
${JSON.stringify(sampleData, null, 2)}

The user wants to filter/query this data. Based on their request, respond with ONLY a JSON object in this exact format:
{
    "explanation": "Brief explanation of what you're filtering",
    "filter": "javascript expression that returns true/false for each row, using 'row' as the variable (e.g., row['price'] > 100)",
    "indices": null
}

If the filter is too complex for a simple expression, instead provide specific row indices:
{
    "explanation": "Brief explanation",
    "filter": null,
    "indices": [0, 2, 5, 10]
}

User query: "${query}"

Respond with ONLY the JSON object, no other text.`;

            try {
                // Register handler for AI response
                window.Poe.registerHandler('dataforge-ai', (result) => {
                    const msg = result.responses[0];

                    if (msg.status === 'error') {
                        aiTypingIndicator.classList.add('hidden');
                        aiResponseText.textContent = 'Error: ' + (msg.statusText || 'Failed to get response');
                        resetAiButton();
                        return;
                    }

                    if (msg.status === 'complete') {
                        aiTypingIndicator.classList.add('hidden');
                        processAiResponse(msg.content);
                        resetAiButton();
                    }
                });

                await window.Poe.sendUserMessage(`@GPT-5.1 ${dataContext}`, {
                    handler: 'dataforge-ai',
                    stream: false,
                    openChat: false
                });
            } catch (err) {
                aiTypingIndicator.classList.add('hidden');
                aiResponseText.textContent = 'Error: ' + (err.message || 'Failed to send query');
                resetAiButton();
            }
        }

        function resetAiButton() {
            aiQueryBtn.disabled = false;
            aiQueryBtn.innerHTML = '<i class="fas fa-bolt mr-1"></i>Ask';
        }

        function processAiResponse(content) {
            try {
                // Extract JSON from response
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                if (!jsonMatch) {
                    aiResponseText.textContent = 'Could not parse AI response. Please try a different query.';
                    return;
                }

                const response = JSON.parse(jsonMatch[0]);

                if (response.filter) {
                    // Apply filter expression
                    try {
                        const filterFn = new Function('row', `return ${response.filter}`);
                        aiFilteredIndices = [];
                        parsedData.forEach((row, idx) => {
                            try {
                                if (filterFn(row)) {
                                    aiFilteredIndices.push(idx);
                                }
                            } catch (e) {
                                // Skip rows that cause errors
                            }
                        });
                    } catch (e) {
                        aiResponseText.textContent = 'Could not apply filter. Please try a different query.';
                        return;
                    }
                } else if (response.indices) {
                    aiFilteredIndices = response.indices.filter(i => i >= 0 && i < parsedData.length);
                } else {
                    aiResponseText.textContent = 'No valid filter found in response.';
                    return;
                }

                // Show result
                aiResponseText.innerHTML = `<strong>${response.explanation}</strong><br><span class="text-xs text-violet-600 dark:text-violet-400">Found ${aiFilteredIndices.length} matching rows</span>`;
                clearAiFilter.classList.remove('hidden');

                // Apply filters
                currentPage = 1;
                applyFilters();
                showToast(`AI filter applied: ${aiFilteredIndices.length} rows match`, 'info');
            } catch (e) {
                aiResponseText.textContent = 'Could not parse AI response. Please try a different query.';
            }
        }

        clearAiFilter.addEventListener('click', () => {
            aiFilteredIndices = null;
            aiResponseArea.classList.add('hidden');
            clearAiFilter.classList.add('hidden');
            aiQueryInput.value = '';
            currentPage = 1;
            applyFilters();
            showToast('AI filter cleared');
        });

        // Event handlers
        parseBtn.addEventListener('click', () => {
            detectAndParse(dataInput.value);
        });

        clearInputBtn.addEventListener('click', () => {
            dataInput.value = '';
        });

        backBtn.addEventListener('click', () => {
            outputSection.classList.add('hidden');
            inputSection.classList.remove('hidden');
            inputSection.classList.add('fade-in');
        });

        // Export functions
        exportExcel.addEventListener('click', () => {
            const dataToExport = filteredData.length ? filteredData : parsedData;
            const ws = XLSX.utils.json_to_sheet(dataToExport, { header: headers });
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Data');
            XLSX.writeFile(wb, 'data_export.xlsx');
            showToast('Excel file downloaded!');
        });

        exportCsv.addEventListener('click', () => {
            const dataToExport = filteredData.length ? filteredData : parsedData;
            const csv = Papa.unparse(dataToExport, { columns: headers });
            downloadFile(csv, 'data_export.csv', 'text/csv');
            showToast('CSV file downloaded!');
        });

        copyTable.addEventListener('click', () => {
            const dataToExport = filteredData.length ? filteredData : parsedData;
            const tsvData = [headers.join('\t'), ...dataToExport.map(row =>
                headers.map(h => row[h] ?? '').join('\t')
            )].join('\n');

            copyToClipboard(tsvData).then(() => {
                showToast('Table copied to clipboard!');
            }).catch(() => {
                showModal('Error', 'Could not copy to clipboard.');
            });
        });

        copyJson.addEventListener('click', () => {
            const dataToExport = filteredData.length ? filteredData : parsedData;
            const jsonStr = JSON.stringify(dataToExport, null, 2);
            copyToClipboard(jsonStr).then(() => {
                showToast('JSON copied to clipboard!');
            }).catch(() => {
                showModal('Error', 'Could not copy to clipboard.');
            });
        });

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        async function copyToClipboard(text) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                return navigator.clipboard.writeText(text);
            }
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-9999px';
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
            } finally {
                document.body.removeChild(textArea);
            }
        }

        // Allow paste shortcut globally when on paste tab
        document.addEventListener('paste', (e) => {
            if (!pastePanel.classList.contains('hidden') && document.activeElement !== dataInput) {
                const pastedData = e.clipboardData.getData('text');
                if (pastedData) {
                    dataInput.value = pastedData;
                    dataInput.focus();
                }
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + F to focus search
            if ((e.ctrlKey || e.metaKey) && e.key === 'f' && !outputSection.classList.contains('hidden')) {
                e.preventDefault();
                searchInput.focus();
            }
        });
    </script>



</body></html>